<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard Usuario</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="/css/modal.css" rel="stylesheet">
    <link href="/css/Dashboard_P.css" rel="stylesheet">
    <link rel="icon" href="favicon.ico">
</head>
<body>
<div class="sidebar">
    <div class="sidebar-header">
        <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" class="profile-pic" id="profilePicDisplay">
        <div class="logo-text" id="usernameDisplay" th:text="${pasajero.nombreCompleto}">User</div>
        <button class="toggle-btn"><i class="fas fa-angle-double-left"></i></button>
    </div>
    <ul>
        <li onclick="showSection('perfil')"><i class="fas fa-user"></i><span class="text">Perfil</span></li>
        <li onclick="showSection('historial')"><i class="fas fa-history"></i><span class="text">Historial</span></li>
        <li onclick="showSection('viaje')"><i class="fas fa-bicycle"></i><span class="text">Pedir Viaje</span></li>
        <li class="logout-item" onclick="document.getElementById('logoutForm').submit()">
            <form id="logoutForm" th:action="@{/auth/logout}" method="post">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <i class="fas fa-sign-out-alt"></i>
                <span class="logout-text">Cerrar sesión</span>
            </form>
        </li>
    </ul>
</div>

<div class="main">
    <div class="section active" id="perfil">

        <h2 id="userFullName" th:text="${pasajero.nombreCompleto}">Nombre del Pasajero</h2>

        <br><br>

        <div class="setting-box">
            <span><i class="fas fa-bell"></i> Notificaciones para recibir promociones</span>
            <input type="checkbox">
        </div>

        <div class="setting-box">
            <span><i class="fas fa-key"></i> Cambiar contraseña</span>
            <button>CAMBIAR</button>
        </div>

        <div class="setting-box">
            <span><i class="fas fa-moon"></i> <span id="darkModeText">Modo oscuro</span></span>
            <button onclick="toggleDarkMode()">CAMBIAR</button>
        </div>
    </div>

    <div class="section" id="historial">
        <h2>Historial de Viajes Realizados</h2>
        <div class="filters">
            <input type="date" id="filtroFecha" placeholder="Filtrar por fecha">
            <input type="text" id="filtroConductor" placeholder="Filtrar por conductor">
            <button onclick="filtrarHistorialPasajero()">Filtrar</button>
            <button onclick="resetFiltrosHistorialPasajero()">Limpiar</button>
        </div>
        <div class="historial-table-container">
            <table id="historialTable">
                <thead>
                <tr>
                    <th>Fecha</th>
                    <th>Hora</th>
                    <th>Origen</th>
                    <th>Destino</th>

                    <th>Precio</th>
                    <th>Acción</th>
                </tr>
                </thead>
                <tbody id="historialBody"></tbody>
            </table>
            <div class="pagination">
                <button onclick="cambiarPaginaPasajero(-1)" disabled id="prevPage"><i class="fas fa-chevron-left"></i></button>
                <span id="pageInfo">Página 1</span>
                <button onclick="cambiarPaginaPasajero(1)" id="nextPage"><i class="fas fa-chevron-right"></i></button>
            </div>
        </div>
    </div>

    <!-- Modal para detalles del viaje  -->
    <div class="modal" id="modalDetallesViaje">
        <div class="modal-content">
            <span class="modal-close" onclick="cerrarModalDetalles()">×</span>
            <h3>Detalles del Viaje</h3>
            <div id="detallesViajeContent"></div>
        </div>
    </div>

    <div class="section" id="viaje">
        <h2 class="h21">Pedir Viaje</h2>
        <div class="ride-request-container">
            <div class="search-panel">
                <div class="location-inputs">
                    <div class="input-group">
                        <i class="fas fa-map-marker-alt"></i>
                        <span class="input-icon"></span>
                        <input type="text" id="origen" placeholder="¿Dónde estás?" class="location-input">
                    </div>
                    <div class="input-group">
                        <i class="fas fa-flag-checkered"></i>
                        <span class="input-icon"></span>
                        <input type="text" id="destino" placeholder="¿A dónde vas?" class="location-input">
                    </div>
                </div>
                <div class="action-buttons">
                    <button class="primary-btn" onclick="calcularRuta()">
                        <i class="fas fa-route"></i> Calcular Ruta
                    </button>
                    <button class="secondary-btn" onclick="limpiarRuta()">
                        <i class="fas fa-trash-alt"></i> Limpiar
                    </button>
                </div>
            </div>
            <div class="map-container">
                <div id="map"></div>
                <div class="map-controls">
                    <button class="map-btn" onclick="centrarMapa()" title="Centrar mapa">
                        <i class="fas fa-crosshairs"></i>
                    </button>
                    <button class="map-btn" onclick="alternarTrafico()" title="Mostrar tráfico">
                        <i class="fas fa-traffic-light"></i>
                    </button>
                </div>
            </div>
            <div class="ride-details-panel" id="rideDetailsPanel">
                <div class="details-header">
                    <h3><i class="fas fa-info-circle"></i> Detalles del Viaje</h3>
                </div>
                <div class="details-content" id="detalle-precio">
                    <div class="empty-state">
                        <i class="fas fa-route"></i>
                        <p>Ingresa origen y destino para calcular tu viaje</p>
                    </div>
                </div>
                <div class="price-input-container">
                    <label for="precioInput"><i class="fas fa-money-bill-wave"></i> Precio sugerido:</label>
                    <input type="text" id="precioInput" placeholder="Ej: 15.000" readonly>
                    <small>Puedes ajustar este valor</small>
                </div>
                <div class="payment-options">
                    <h4><i class="fas fa-wallet"></i> Método de pago:</h4>
                    <div class="options-grid">
                        <div class="option-card selected">
                            <i class="fas fa-money-bill-alt"></i>
                            <span>Efectivo</span>
                        </div>
                    </div>
                </div>
                <button class="request-ride-btn" id="requestRideBtn">
                    <i class="fas fa-car"></i> Solicitar Viaje
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div id="motoModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modalTitle">Buscando conductor...</h3>
            <span class="close-btn" id="closeModalBtn">×</span>
        </div>
        <div class="modal-body">
            <div class="spinner"></div>
            <p id="modalMessage">Por favor espera mientras encontramos un conductor para ti</p>
            <div id="driverInfo" style="display: none;">
                <img id="driverPhoto" src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" class="driver-photo">
                <h4 id="driverName">Nombre del Conductor</h4>
                <p id="driverStatus">Preparándose para recogerte</p>
                <div class="vehicle-info">
                    <i class="fas fa-motorcycle"></i>
                    <span>Motocicleta</span>
                </div>
            </div>
            <div id="progressContainer" style="display: none;">
                <div class="progress-bar">
                    <div class="progress" id="progressBar"></div>
                </div>
                <div class="locations">
                    <span class="origin" id="originText">Origen</span>
                    <span class="destination" id="destinationText">Destino</span>
                </div>
            </div>

        </div>
    </div>
</div>

<script src="/js/Dashboard_P.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.6.1/sockjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD-lMXvr0vMKjw97iEX9QibzK0TCx2TAMY&libraries=places&v=weekly" onload="initMap()" async></script>
</body>
</html>